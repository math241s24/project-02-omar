library(migest)
library(circlize)
library(countrycode)
library(tidyverse)
library(ggrepel)
library(ggmap)
library(dplyr)
library(gganimate)
library(ggplot2)
library(RColorBrewer)
library(maps)
library(ggspatial)
library(leaflet)
library(osmdata)
library(sf)
library(ggthemes)
library(shiny)
library(gt)
library(countrycode)
us_dot_air_intl_2023 <- read_csv("../data/us-dot-air-intl-2023.csv")
us_dot_air_intl_2023 <- read_csv("data/us-dot-air-intl-2023.csv")
airports <- read.csv("data/airports.dat")
airlines <- read.csv("data/airlines.dat")
countries <- read_csv("data/countries.dat", col_names = FALSE)
colnames(airports) <- c("AirportID", "Name", "City", "Country", "IATA", "ICAO", "Latitude", "Longitude", "Altitude", "Timezone", "DST", "TimeRegion")
colnames(countries) <- c("Name", "ISO_Code", "DAFIF_Code")
colnames(airlines) <- c("OpenFlightsID", "Name", "Alias", "IATA", "ICAO", "Callsign", "Country", "Active")
countries$region <- countrycode(sourcevar = countries$Name,
origin = "country.name",
destination = "region")
countries <- countries %>% group_by(region) %>% drop_na()
airports$region <- countrycode(sourcevar = airports$Country,
origin = "country.name",
destination = "region")
airlines$region <- countrycode(sourcevar = airlines$Country,
origin = "country.name",
destination = "region")
airports <- airports %>% drop_na(IATA)
us_airports <- airports[grep("United States", airports$Country), ]
intlTravel_2022 <- us_dot_air_intl_2023 %>% filter(Year == 2022 | Year == 2021)
us_dot_air_intl_2023 <- us_dot_air_intl_2023 %>%
left_join(airports %>%
select(IATA, us_long = Longitude, us_lat = Latitude),
by = c("usg_apt" = "IATA")) %>%
left_join(airports %>%
select(IATA, fg_long = Longitude, fg_lat = Latitude),
by = c("fg_apt" = "IATA"))
us_dot_air_intl_2023$us_long <- as.numeric(us_dot_air_intl_2023$us_long, na.rm = TRUE)
us_dot_air_intl_2023$us_lat <- as.numeric(us_dot_air_intl_2023$us_lat, na.rm = TRUE)
us_dot_air_intl_2023$fg_long <- as.numeric(us_dot_air_intl_2023$fg_long, na.rm = TRUE)
us_dot_air_intl_2023$fg_lat <- as.numeric(us_dot_air_intl_2023$fg_lat, na.rm = TRUE)
AirlineTable <- merge(us_dot_air_intl_2023, airlines[, c("IATA", "Country", "region", "Name")],
by.x = "carrier", by.y = "IATA") %>% na.omit()
us_dot_air_intl_2023 <- merge(us_dot_air_intl_2023, airports[, c("IATA", "Country", "region")],
by.x = "fg_apt", by.y = "IATA", all.x = TRUE)
poproutes <- us_dot_air_intl_2023 %>%
group_by(Year, Month, usg_apt, fg_apt, us_long, us_lat, fg_long, fg_lat, Country, region) %>%
summarize(count = sum(Total)) %>%
arrange(Year, desc(count))
poproutes <- poproutes %>% na.omit()
poproutesPrev <- us_dot_air_intl_2023 %>% filter(Year == 2022) %>%
group_by(Year, Month, usg_apt, fg_apt, us_long, us_lat, fg_long, fg_lat, Country, region) %>%
summarize(count = sum(Total)) %>%
arrange(Year, desc(count))
popair <- AirlineTable %>%
group_by(Year, Month, carrier, Name, usg_apt, fg_apt, us_long, us_lat, fg_long, fg_lat, Country, region) %>%
summarize(count = sum(Total)) %>%
arrange(Year, desc(count)) %>% na.omit()
# US-FOREIGN PERCENT GRAPH
highlight_events <- data.frame(
event = c("9/11", "2008 Recession", "COVID-19"),
start_year = c(2001, 2008, 2020),
end_year = c(2002, 2009, 2022),
Year = c(2001, 2008, 2020)
)
airlineOrigin <- us_dot_air_intl_2023 %>%
group_by(Year) %>%
summarize(percentage = mean(!carriergroup) * 100,
total = sum(Total))
plo <- ggplot() +
geom_line(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
geom_point(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
labs(x = "Year",
y = "Percentage of Flights",
color = "Passenger Counts",
title = "Percentage of Non-U.S. Airline Flights Over Time",
subtitle = "Data sourced from U.S. Dept. Of Transportation from 1990-2023") +
geom_rect(data = highlight_events, aes(xmin = start_year, xmax=end_year, ymin=-Inf, ymax = Inf, fill = "gray", alpha = 0.2)) +
geom_text_repel(
data = highlight_events,
aes(x = start_year + (end_year - start_year) / 2, y = 50, label = event),
segment.size = 0.5,
nudge_x = 3,
nudge_y = 1.5,
size = 3) +
scale_color_continuous(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
guides(fill = "none", alpha = "none") +
transition_reveal(event)
animate(plo)
# US-FOREIGN PERCENT GRAPH
highlight_events <- data.frame(
event = c("9/11", "2008 Recession", "COVID-19"),
start_year = c(2001, 2008, 2020),
end_year = c(2002, 2009, 2022),
Year = c(2001, 2008, 2020)
)
airlineOrigin <- us_dot_air_intl_2023 %>%
group_by(Year) %>%
summarize(percentage = mean(!carriergroup) * 100,
total = sum(Total))
plo <- ggplot() +
geom_line(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
geom_point(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
labs(x = "Year",
y = "Percentage of Flights",
color = "Passenger Counts",
title = "Percentage of Non-U.S. Airline Flights Over Time",
subtitle = "Data sourced from U.S. Dept. Of Transportation from 1990-2023") +
geom_rect(data = highlight_events, aes(xmin = start_year, xmax=end_year, ymin=-Inf, ymax = Inf, fill = "gray", alpha = 0.2)) +
geom_text_repel(
data = highlight_events,
aes(x = start_year + (end_year - start_year) / 2, y = 50, label = event),
segment.size = 0.5,
nudge_x = 3,
nudge_y = 1.5,
size = 3) +
scale_color_continuous(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
guides(fill = "none", alpha = "none") +
transition_reveal(highlight_events$event)
animate(plo)
# US-FOREIGN PERCENT GRAPH
highlight_events <- data.frame(
event = c("9/11", "2008 Recession", "COVID-19"),
start_year = c(2001, 2008, 2020),
end_year = c(2002, 2009, 2022),
Year = c(2001, 2008, 2020)
)
airlineOrigin <- us_dot_air_intl_2023 %>%
group_by(Year) %>%
summarize(percentage = mean(!carriergroup) * 100,
total = sum(Total))
plo <- ggplot() +
geom_line(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
geom_point(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
labs(x = "Year",
y = "Percentage of Flights",
color = "Passenger Counts",
title = "Percentage of Non-U.S. Airline Flights Over Time",
subtitle = "Data sourced from U.S. Dept. Of Transportation from 1990-2023") +
geom_rect(data = highlight_events, aes(xmin = start_year, xmax=end_year, ymin=-Inf, ymax = Inf, fill = "gray", alpha = 0.2)) +
geom_text_repel(
data = highlight_events,
aes(x = start_year + (end_year - start_year) / 2, y = 50, label = event),
segment.size = 0.5,
nudge_x = 3,
nudge_y = 1.5,
size = 3) +
scale_color_continuous(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
guides(fill = "none", alpha = "none") +
transition_reveal(Year)
animate(plo)
# US-FOREIGN PERCENT GRAPH
highlight_events <- data.frame(
event = c("9/11", "2008 Recession", "COVID-19"),
start_year = c(2001, 2008, 2020),
end_year = c(2002, 2009, 2022),
Year = c(2001, 2008, 2020)
)
airlineOrigin <- us_dot_air_intl_2023 %>%
group_by(Year) %>%
summarize(percentage = mean(!carriergroup) * 100,
total = sum(Total))
plo <- ggplot() +
geom_line(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
geom_point(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
labs(x = "Year",
y = "Percentage of Flights",
color = "Passenger Counts",
title = "Percentage of Non-U.S. Airline Flights Over Time",
subtitle = "Data sourced from U.S. Dept. Of Transportation from 1990-2023") +
geom_rect(data = highlight_events, aes(xmin = start_year, xmax=end_year, ymin=-Inf, ymax = Inf, fill = "gray", alpha = 0.2)) +
geom_text_repel(
data = highlight_events,
aes(x = start_year + (end_year - start_year) / 2, y = 50, label = event),
segment.size = 0.5,
nudge_x = 3,
nudge_y = 1.5,
size = 3) +
scale_color_continuous(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
guides(fill = "none", alpha = "none") +
transition_time(start_year)
animate(plo)
# US-FOREIGN PERCENT GRAPH
highlight_events <- data.frame(
event = c("9/11", "2008 Recession", "COVID-19"),
start_year = c(2001, 2008, 2020),
end_year = c(2002, 2009, 2022),
Year = c(2001, 2008, 2020)
)
airlineOrigin <- us_dot_air_intl_2023 %>%
group_by(Year) %>%
summarize(percentage = mean(!carriergroup) * 100,
total = sum(Total))
plo <- ggplot() +
geom_line(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
geom_point(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
labs(x = "Year",
y = "Percentage of Flights",
color = "Passenger Counts",
title = "Percentage of Non-U.S. Airline Flights Over Time",
subtitle = "Data sourced from U.S. Dept. Of Transportation from 1990-2023") +
geom_rect(data = highlight_events, aes(xmin = start_year, xmax=end_year, ymin=-Inf, ymax = Inf, fill = "gray", alpha = 0.2)) +
geom_text_repel(
data = highlight_events,
aes(x = start_year + (end_year - start_year) / 2, y = 50, label = event),
segment.size = 0.5,
nudge_x = 3,
nudge_y = 1.5,
size = 3) +
scale_color_continuous(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
guides(fill = "none", alpha = "none") +
transition_time(start_year)
animate(plo)
# US-FOREIGN PERCENT GRAPH
highlight_events <- data.frame(
event = c("9/11", "2008 Recession", "COVID-19"),
start_year = c(2001, 2008, 2020),
end_year = c(2002, 2009, 2022),
Year = c(2001, 2008, 2020)
)
airlineOrigin <- us_dot_air_intl_2023 %>%
group_by(Year) %>%
summarize(percentage = mean(!carriergroup) * 100,
total = sum(Total))
plo <- ggplot() +
geom_line(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
geom_point(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
labs(x = "Year",
y = "Percentage of Flights",
color = "Passenger Counts",
title = "Percentage of Non-U.S. Airline Flights Over Time",
subtitle = "Data sourced from U.S. Dept. Of Transportation from 1990-2023") +
geom_rect(data = highlight_events, aes(xmin = start_year, xmax=end_year, ymin=-Inf, ymax = Inf, fill = "gray", alpha = 0.2)) +
geom_text_repel(
data = highlight_events,
aes(x = start_year + (end_year - start_year) / 2, y = 50, label = event),
segment.size = 0.5,
nudge_x = 3,
nudge_y = 1.5,
size = 3) +
scale_color_continuous(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
guides(fill = "none", alpha = "none") +
transition_time(start_year)
animate(plo)
/* CSS for the table */
View(intlTravel_2022)
# US-FOREIGN PERCENT GRAPH
highlight_events <- data.frame(
event = c("9/11", "2008 Recession", "COVID-19"),
start_year = c(2001, 2008, 2020),
end_year = c(2002, 2009, 2022),
Year = c(2001, 2008, 2020)
)
airlineOrigin <- us_dot_air_intl_2023 %>% filter(Year == 2022) %>%
group_by(Year) %>%
summarize(percentage = mean(!carriergroup) * 100,
total = sum(Total))
plo <- ggplot() +
geom_line(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
geom_point(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
labs(x = "Year",
y = "Percentage of Flights",
color = "Passenger Counts",
title = "Percentage of Non-U.S. Airline Flights Over Time",
subtitle = "Data sourced from U.S. Dept. Of Transportation from 1990-2023") +
geom_rect(data = highlight_events, aes(xmin = start_year, xmax=end_year, ymin=-Inf, ymax = Inf, fill = "gray", alpha = 0.2)) +
geom_text_repel(
data = highlight_events,
aes(x = start_year + (end_year - start_year) / 2, y = 50, label = event),
segment.size = 0.5,
nudge_x = 3,
nudge_y = 1.5,
size = 3) +
scale_color_continuous(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
guides(fill = "none", alpha = "none") +
transition_time(start_year)
animate(plo)
# US-FOREIGN PERCENT GRAPH
highlight_events <- data.frame(
event = c("9/11", "2008 Recession", "COVID-19"),
start_year = c(2001, 2008, 2020),
end_year = c(2002, 2009, 2022),
Year = c(2001, 2008, 2020)
)
airlineOrigin <- us_dot_air_intl_2023 %>% filter(Year == 2022) %>%
group_by(Year) %>%
summarize(percentage = mean(!carriergroup) * 100,
total = sum(Total))
plo <- ggplot() +
geom_line(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
geom_point(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
labs(x = "Year",
y = "Percentage of Flights",
color = "Passenger Counts",
title = "Percentage of Non-U.S. Airline Flights Over Time",
subtitle = "Data sourced from U.S. Dept. Of Transportation from 1990-2023") +
geom_rect(data = highlight_events, aes(xmin = start_year, xmax=end_year, ymin=-Inf, ymax = Inf, fill = "gray", alpha = 0.2)) +
geom_text_repel(
data = highlight_events,
aes(x = start_year + (end_year - start_year) / 2, y = 50, label = event),
segment.size = 0.5,
nudge_x = 3,
nudge_y = 1.5,
size = 3) +
scale_color_continuous(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
guides(fill = "none", alpha = "none") +
transition_time(Year)
animate(plo)
# US-FOREIGN PERCENT GRAPH
highlight_events <- data.frame(
event = c("9/11", "2008 Recession", "COVID-19"),
start_year = c(2001, 2008, 2020),
end_year = c(2002, 2009, 2022),
Year = c(2001, 2008, 2020)
)
airlineOrigin <- us_dot_air_intl_2023 %>% filter(Year == 2022) %>%
group_by(Year) %>%
summarize(percentage = mean(!carriergroup) * 100,
total = sum(Total))
plo <- ggplot() +
geom_line(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
geom_point(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
labs(x = "Year",
y = "Percentage of Flights",
color = "Passenger Counts",
title = "Percentage of Non-U.S. Airline Flights Over Time",
subtitle = "Data sourced from U.S. Dept. Of Transportation from 1990-2023") +
geom_rect(data = highlight_events, aes(xmin = start_year, xmax=end_year, ymin=-Inf, ymax = Inf, fill = "gray", alpha = 0.2)) +
geom_text_repel(
data = highlight_events,
aes(x = start_year + (end_year - start_year) / 2, y = 50, label = event),
segment.size = 0.5,
nudge_x = 3,
nudge_y = 1.5,
size = 3) +
scale_color_continuous(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
guides(fill = "none", alpha = "none") +
transition_layers(layer_length = 1, transition_length = 2) +
enter_fade() + exit_fade()
animate(plo)
# US-FOREIGN PERCENT GRAPH
highlight_events <- data.frame(
event = c("9/11", "2008 Recession", "COVID-19"),
start_year = c(2001, 2008, 2020),
end_year = c(2002, 2009, 2022),
Year = c(2001, 2008, 2020)
)
airlineOrigin <- us_dot_air_intl_2023 %>% filter(Year == 2022) %>%
group_by(Year) %>%
summarize(percentage = mean(!carriergroup) * 100,
total = sum(Total))
plo <- ggplot() +
geom_line(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
geom_point(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
labs(x = "Year",
y = "Percentage of Flights",
color = "Passenger Counts",
title = "Percentage of Non-U.S. Airline Flights Over Time",
subtitle = "Data sourced from U.S. Dept. Of Transportation from 1990-2023") +
geom_rect(data = highlight_events, aes(xmin = start_year, xmax=end_year, ymin=-Inf, ymax = Inf, fill = "gray", alpha = 0.2)) +
geom_text_repel(
data = highlight_events,
aes(x = start_year + (end_year - start_year) / 2, y = 50, label = event),
segment.size = 0.5,
nudge_x = 3,
nudge_y = 1.5,
size = 3) +
scale_color_continuous(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
guides(fill = "none", alpha = "none") +
transition_events(start = start_year, end = end_year) +
enter_fade() + exit_fade()
animate(plo)
# US-FOREIGN PERCENT GRAPH
highlight_events <- data.frame(
event = c("9/11", "2008 Recession", "COVID-19"),
start_year = c(2001, 2008, 2020),
end_year = c(2002, 2009, 2022),
Year = c(2001, 2008, 2020)
)
airlineOrigin <- us_dot_air_intl_2023 %>% filter(Year == 2022) %>%
group_by(Year) %>%
summarize(percentage = mean(!carriergroup) * 100,
total = sum(Total))
plo <- ggplot() +
geom_line(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
geom_point(data = airlineOrigin, aes(x = Year, y = percentage, color = total)) +
labs(x = "Year",
y = "Percentage of Flights",
color = "Passenger Counts",
title = "Percentage of Non-U.S. Airline Flights Over Time",
subtitle = "Data sourced from U.S. Dept. Of Transportation from 1990-2023") +
geom_rect(data = highlight_events, aes(xmin = start_year, xmax=end_year, ymin=-Inf, ymax = Inf, fill = "gray", alpha = 0.2)) +
geom_text_repel(
data = highlight_events,
aes(x = start_year + (end_year - start_year) / 2, y = 50, label = event),
segment.size = 0.5,
nudge_x = 3,
nudge_y = 1.5,
size = 3) +
scale_color_continuous(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
guides(fill = "none", alpha = "none") +
transition_events(start = start_year, end = end_year)
animate(plo)
runApp('code')
# AIRLINE TABLE
popair %>%
filter(!is.na(Name) & !is.na(region)) %>%
group_by(region, Name, Country) %>%
summarize(passenger_count = sum(count, na.rm = TRUE)) %>%
ungroup() %>%
group_by(region) %>%
arrange(desc(passenger_count)) %>%
slice_head(n = 15) %>%
mutate(code2 = countrycode(sourcevar = Country, origin = "country.name", destination = "iso2c")) %>%
# Create the gt table
gt() %>%
# Move code2 column to the start
cols_move_to_start(columns = code2) %>%
# Format passenger_count as integer
fmt_integer(columns = passenger_count) %>%
# Add flag icons for regions
fmt_flag(columns = code2) %>%
# Set row padding
tab_options(data_row.padding = px(5)) %>%
# Set column labels
cols_label(
code2 = "",
region = "Region",
Name = "Airline",
passenger_count = "Passenger Count"
)
options(viewr=NULL)
# AIRLINE TABLE
popair %>%
filter(!is.na(Name) & !is.na(region)) %>%
group_by(region, Name, Country) %>%
summarize(passenger_count = sum(count, na.rm = TRUE)) %>%
ungroup() %>%
group_by(region) %>%
arrange(desc(passenger_count)) %>%
slice_head(n = 15) %>%
mutate(code2 = countrycode(sourcevar = Country, origin = "country.name", destination = "iso2c")) %>%
# Create the gt table
gt() %>%
# Move code2 column to the start
cols_move_to_start(columns = code2) %>%
# Format passenger_count as integer
fmt_integer(columns = passenger_count) %>%
# Add flag icons for regions
fmt_flag(columns = code2) %>%
# Set row padding
tab_options(data_row.padding = px(5)) %>%
# Set column labels
cols_label(
code2 = "",
region = "Region",
Name = "Airline",
passenger_count = "Passenger Count"
)
# AIRLINE TABLE
popair %>%
filter(!is.na(Name) & !is.na(region)) %>%
group_by(region, Name, Country) %>%
summarize(passenger_count = sum(count, na.rm = TRUE)) %>%
ungroup() %>%
group_by(region) %>%
arrange(desc(passenger_count)) %>%
slice_head(n = 15) %>%
mutate(code2 = countrycode(sourcevar = Country, origin = "country.name", destination = "iso2c")) %>%
# Create the gt table
gt() %>%
# Move code2 column to the start
cols_move_to_start(columns = code2) %>%
# Format passenger_count as integer
fmt_integer(columns = passenger_count) %>%
# Add flag icons for regions
fmt_flag(columns = code2) %>%
# Set row padding
tab_options(data_row.padding = px(5)) %>%
# Set column labels
cols_label(
code2 = "",
region = "Region",
Name = "Airline",
passenger_count = "Passenger Count"
)
runApp('code')
::: fragment
pwd
pwd()
ls
